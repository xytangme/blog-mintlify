---
title: "保证金交易风险管理（二）资金费率"
date: 2025-05-06T11:42:46+08:00
series: ["Derivatives Trading"]
draft: false
---

接上文 [保证金交易风险管理之指数价格](../derivatives-002) ，要理解标记价格的计算方式，除了 __指数价格__ 或称 __价格指数__ 还需要理解 __资金费率__。

传统期货合约有到期日，越接近到期日，期货和现货的价格越会趋于一致，但是加密货币的永续合约没有到期日，于是交易所创造了 __资金费用__ 这个机制，通过使多头和空头互相支付资金费用的方式，来鼓励交易者做多头（当空头向多头支付资金费用）或者空头（当多头向空头支付资金费用），从而使得永续合约的价格趋近于现货。资金费用周期性结算，通常为每8小时一次，或者每4小时一次，其计算方式为

$$
资金费用 = 标记价格 * 合约数量 * 资金费率
$$

- 当市场看涨时，资金费率为正数，多头向空头支付资金费用，吸引空头

- 当市场看跌时，资金费率为负数，空头向多头支付资金费用，吸引多头

资金费率主要有两大因素决定：利率和溢价。

## 利率

在交易平台上，如Binance或者Bybit，一般情况下利率是固定的每天0.03%，那么对于每8小时结算一次 aka 每天结算三次的资金费用来说，每次结算的利率为0.01%（注意不是复利计算）。

在[Binance的文档](https://www.binance.com/zh-CN/support/faq/detail/360033525031)里，对此有一句解释：

> 币安使用固定利率，假定持有等值现金的收益高于持有等值 BTC 的利息。

稍微展开：

- 持有加密货币如BTC，可以通过质押或者接借贷等方式获取一定的收益

- 如果不持有加密货币，而是持有法币现金如美元，可以将现金存入银行，或者购买低风险的金融产品，如国债，来获取一定的收益，这个无风险或者说低风险的收益率，称为 __无风险利率__

- 币安的假设是，无风险利率要比持有等值BTC获取的收益率要高

- 一个正值的利率，是对多头的惩罚，和对空头的补偿

    - 多头借入现金开多仓，用来开仓的现金损失了本来可以有的无风险收益

    - 空头借入加密货币资产换取现金，然后通过现金获得无风险收益

## 溢价 & 溢价指数

所谓溢价，即合约价格相对于标记价格的溢价或者折价，而溢价指数，则是一种衡量溢价或者折价程度，或者说合约价格偏离程度的指标。溢价指数的正负和大小变化，最终决定了资金费率（毕竟利率是固定的），其计算公式为

$$
溢价指数 = [Max(0, 冲击买价 - 指数价格) - Max(0, 指数价格 - 冲击卖价)] / 指数价格
$$

- 指数价格参看前文 [保证金交易风险管理之指数价格](../derivatives-002)

- 冲击买价 = 买入 __冲击保证金名义金额__ 的平均成交价

- 冲击卖价 = 卖出 __冲击保证金名义金额__ 的平均成交价

- 冲击保证金名义金额 (Impact Margin Notional, IMN) = 一个用于衡量市场深度的“标准交易价值”

### 冲击保证金名义金额 IMN

#### Why

- 为了衡量合约价格的偏离程度，为什么不直接用买一/卖一价？因为买一/卖一量可能很小，价格容易被操纵

- 更真实的市场状况体现在，如果你想交易一个有一定数量的订单时，你能获得的平均成交价格是多少？你需要“吃掉”盘口上多深的订单？

- 为了计算这个“有一定数量”订单的平均成交价格（也就是冲击买价/卖价），交易所需要一个标准来确定这个“一定数量”应该是多少

- 这个标准不能简单地是一个固定的基础货币数量（比如永远用 1 BTC 来测），因为 1 BTC 在 BTC 价格高的时候价值很高，在价格低的时候价值很低，在另一个币种（比如 ETH 或一个很便宜的山寨币）上更是完全不适用

- 所以，交易所需要一个标准化的、跨币种的、基于价值的衡量单位来确定这个测试深度所需的“交易大小”，即冲击保证金名义金额

#### What

- 简单来说，IMN 是交易所定义的一个名义价值 (Notional Value)，用来代表一个具有一定“市场冲击力”的标准交易大小

- 这个名义价值的计算方式通常与保证金和最高杠杆有关，这是为了将这个“标准交易大小”与合约交易的实际环境联系起来

- Binance 公式：

    $$
    冲击保证金额(IMN) = 固定基准金额 (200 USDT) / 最高杠杆下的起始保证金率
    $$

    - Why 200u? 没有说明

    - 最高杠杆：顾名思义，合约允许的最大杠杆倍数

    - 起始保证金率：通常为杠杆的倒数，如100x 杠杆对应的初始保证金率是 \\( 1 / 100 = 0.01 \\)。
    
    - 这个公式实际上是在问：“如果我使用最高杠杆，需要投入固定基准金额（例如 200 USDT）作为初始保证金，那么我可以开多大名义价值的仓位？”

- IMN与基础代币的转换公式为

    $$
    代币数量 = IMN / ( (买一价 + 卖一价) / 2)
    $$

### 冲击买价 & 冲击卖价

从订单簿计算平均买入价和卖出价的计算过程参考 [Binance的文档](https://www.binance.com/zh-CN/support/faq/detail/360033525031)

### 溢价指数

- \\( Max(0, 冲击买价 - 指数价格) \\) 代表了买方市场存在的溢价部分

    - 如果冲击买价高于指数价格，说明买入时需要付出溢价（相对于指数价格），这个差值就是正数，取它

    - 如果冲击买价等于或低于指数价格，说明买入时没有溢价（或有折价），差值非正，取 0

- \\( Max(0, 指数价格 - 冲击卖价) \\) 代表了卖方市场存在的折价部分

    - 如果指数价格高于冲击卖价，说明卖出时会遭遇折价（相对于指数价格），这个差值就是正数，取它

    - 如果指数价格等于或低于深度加权卖价，说明卖出时没有折价（或有溢价），差值非正，取 0

- \\( [Max(0, 冲击买价 - 指数价格) - Max(0, 指数价格 - 冲击卖价)] \\) 衡量的是买方溢价的强度与卖方折价强度之间的净值，这个差值代表了合约价格相对指数价格的总体溢价或折价

    - 如果买方溢价项 > 0 且卖方折价项 = 0，结果为买方溢价项（正）

    - 如果买方溢价项 = 0 且卖方折价项 > 0，结果为 -（卖方折价项）（负）

    - 如果两个都 > 0，结果是它们的差值

- 最后除以指数价格，标准化成一个百分比，即买卖IMN大小的合约造成的价格偏离程度，aka溢价指数

## 资金费率

理解了利率和溢价指数，资金费率就很直接了

$$
资金费率 = 平均溢价指数 + clamp (利率 - 平均溢价指数, -0.05\\%, 0.05\\%)
$$

- 以每8小时/480分钟的资金费率结算为例，\\(平均溢价指数 = (溢价指数 _1 * 1 + 溢价指数 _2 * 2 +... + 溢价指数 _480 * 480) / (1 + 2 +... + 480)\\)

    - 这个加权平均的设计目的是为了让近期（更靠近结算时间）的市场溢价/折价状态对资金费率有更大的影响

- 如果平均溢价指数与利率的差异在 +/-0.05% 的范围内，最终的资金费率将等于利率

    - 在市场偏离不大时保持稳定的资金费率，维持基础的套利激励

- 如果利率比平均溢价指数高出超过 0.05%，资金费率将等于平均溢价指数加上 0.05%

    - 当利率显著高于平均溢价指数，aka合约价格相对很低，交易者倾向于开多头仓位，合约价格上涨
    
- 如果利率比平均溢价指数低了超过 0.05%，资金费率将等于平均溢价指数减去 0.05%

    - 当利率显著低于平均溢价指数，aka合约价格相对很高，交易者倾向于开空头仓位，合约价格下跌

## 挖坑

本来只想浅浅了解一下概念，没想到看着看着衍生出很多问题，挖个坑先，填不填的再说

- 如果利率为负，对资金费用和流动性有什么影响？

- 当冲击保证金额的固定基准金额变大或者变小，对结果有什么影响？

- 资金费率为什么要设置上限和下限？

以上。
