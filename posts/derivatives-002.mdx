---
title: "保证金交易风险管理（一）指数价格"
date: 2025-04-30T22:10:50+08:00
series: ["Derivatives Trading"]
draft: false
---

之前说要学习风险管理，结果毫不意外的死在了[第一课](../derivatives-001)，反思了一下，决定换个方式，不从课本开始，而是从离工作最近的交易风控开始。

对于交易平台而言，风控的一项重要职责是降低由于资产价格剧烈波动，或者市场被操纵给用户所带来的风险，而其中的一项核心机制叫做 __标记价格__。要理解标记价格的计算方式，又要先理解 __指数价格__ 或称 __价格指数__ 的计算方式。这里以两家头部衍生品交易所[Binance](https://www.binance.com/zh-CN/support/faq/detail/360033525071)和[Bybit](https://www.bybit.com/zh-MY/help-center/article/Index-Price-CalculationBybit_Perpetual_Contract_mechanism)的文档来做说明。（[OKX](https://www.okx.com/zh-hans/help/i-spot-index-prices)你们自己对比看看这写的什么东西）

简单来讲，类似标普500指数是500支成分股的加权平均，一种加密货币的指数价格是不同交易平台现货报价的加权平均，比起只使用自家的成交价格，指数价格较为公平。有了指数价格，在它的基础之上计算标记价格，再进一步计算盈亏、强制平仓价格、自动减仓等，从而实现风险控制。

因为指数价格是一种加权平均价格，那么它的计算就有两大核心问题，即 1）应该采用哪里的报价 和 2）如何计算权重。

## 价格来源

Binance和Bybit均采用了交易量较大的头部交易所，毕竟这些所通常拥有较好的流动性，价格被操控的空间也更小。不同的是，Binance使用了[8家交易所](https://www.binance.com/zh-CN/futures/funding-history/perpetual/index)的报价并公开了交易所名称，而Bybit仅说明他们使用了6家全球顶级现货交易所。不过论现货交易量，top 6我猜应该跟币安的名单重合度较高。

### 交叉汇率

如果需要计算以USDT计算的指数价格，但没有目标币种和USDT的交易对，则会采用基于现行报价兑换为USDT交易对的价格，例如根据 LINK/BTC 和 BTC/USDT 计算 LINK/USDT。

## 权重计算

基础的权重计算方式，由于Binance没有说的很清楚，就以Bybit为例，是基于4小时交易量的标准化，即

> 指数价格 = (A 交易对现货价格 × A 交易对权重) + (B 交易对现货价格 × B 交易对权重) + (C 交易对现货价格 × C 交易对权重) + (D 交易对现货价格 × D 交易对权重) + (E 交易对现货价格 × E 交易对权重) + (F 交易对现货价格 × F 交易对权重) 

> 其中 A 交易对权重 = A 交易对 4 小时交易量 / [A 交易对 4 小时交易量 + B 交易对 4 小时交易量 + C 交易对 4 小时交易量 + D 交易对 4 小时交易量 + E 交易对 4 小时交易量 + F 交易对 4 小时交易量] 以此类推

但它也没有说明多久更新一次（摊手

当然了，如果只是这样简单的计算，是没办法控制风险的，所以在这个基础公式之上，还需要一些在特殊情况下的保护措施才行。

### 部分交易所价格偏差

既然是偏差，那么就有一个基准比较对象，Binance和Bybit均采用的是 __所有价格来源的中间价__，且幅度限制都是 __5%__。但在应对措施方面，Binance会保留价格来源，但将超出的价格部分剔除，而Bybit则是直接将偏差超过5%的价格从计算中直接剔除。

问题来了，一家两家有偏差好说，如果所有都出现了偏差呢？Binance没有说明，Bybit的做法是

> 在极端场景下，若所有交易所的现货价格于中间价均偏差超过5%，被剔除的交易所权重将会平滑分配至其他未被剔除的交易所，直至最后两家按权重比例计算出指数价格。

Hmmm 不是很理解，先跳过吧。

### 部分交易所价格缺失

如果取不到数据，两家的做法都是剔除，但Biance的时间限制是5分钟，Bybit是15分钟。

### 现货价格全部无法获取

在极端情况下，如果获取不到任何现货报价，两家的做法都是基于合约价格来计算指数价格和标记价格。Binance的说法比较模糊：

> 根据特定限制范围内的合约最新交易价格更新

Bybit的计算方法比较明确，[但太长了所以不摘录了直接看文档吧](https://www.bybit.com/zh-MY/help-center/article/Index-Price-CalculationBybit_Perpetual_Contract_mechanism)。

以上。
